<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ti·ªÉu L·ª•c Nh√¢m Giang Th·ªã - Mobile</title>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --text-color: #333;
            --border-color: #5d4037;
            --highlight: #d32f2f;
            --blue-text: #1976d2;
            --green-text: #388e3c;
            --gold-text: #fbc02d;
            --purple-text: #7b1fa2;
            --white: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            max-width: 950px;
            margin: 0 auto;
            padding: 15px;
            font-size: 16px;
        }

        h1 { 
            text-align: center; 
            color: var(--border-color); 
            margin-bottom: 20px; 
            font-size: 1.5rem;
        }

        /* --- INPUT CONTROLS --- */
        .controls {
            background: var(--white); 
            padding: 20px; 
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px;
            justify-content: center; 
            align-items: flex-end;
            margin-bottom: 25px;
        }

        .input-group { display: flex; flex-direction: column; width: 30%; min-width: 150px; }
        .input-group label { font-weight: 600; font-size: 0.9em; margin-bottom: 8px; color: #555; }
        
        input, select { 
            padding: 12px; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
            font-size: 16px; 
            width: 100%; 
            background: #fff;
        }
        
        button {
            padding: 12px 30px; 
            font-size: 16px; 
            font-weight: bold;
            background-color: var(--border-color); 
            color: white;
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: 0.2s; 
            height: 46px;
            width: auto;
        }
        button:active { background-color: #3e2723; transform: scale(0.98); }

        /* --- GRID QU·∫∫ --- */
        .que-container {
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px;
            background-color: #ddd; 
            border: 4px solid var(--border-color);
            margin-bottom: 25px;
            border-radius: 4px;
        }

        .cung-box {
            background-color: var(--white); 
            padding: 10px 5px; 
            min-height: 140px;
            display: flex; 
            flex-direction: column; 
            justify-content: space-between;
            text-align: center; 
            position: relative;
        }

        .target-cung { background-color: #e3f2fd !important; border: 2px solid var(--blue-text); }
        .self-cung { background-color: #fff3e0 !important; border: 2px solid var(--highlight); }
        
        /* ƒê·ªãnh v·ªã Desktop */
        .pos-1 { grid-column: 1; grid-row: 1; } 
        .pos-2 { grid-column: 2; grid-row: 1; } 
        .pos-3 { grid-column: 3; grid-row: 1; } 
        .pos-0 { grid-column: 1; grid-row: 2; } 
        .pos-5 { grid-column: 2; grid-row: 2; } 
        .pos-4 { grid-column: 3; grid-row: 2; } 

        .top-info { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; padding: 0 5px;}
        .ngu-tinh { color: #f57f17; }
        .luc-than { color: var(--blue-text); }
        .dia-chi { font-size: 1.3em; font-weight: 800; color: var(--green-text); margin: 5px 0; }
        .luc-than-body { font-size: 1em; font-weight: bold; color: var(--purple-text); }
        .cung-name { font-weight: bold; color: #555; font-size: 0.9em; }
        .markers { 
            position: absolute; bottom: 2px; left: 2px; right: 2px;
            font-size: 0.65em; font-weight: bold; 
            display: flex; gap: 2px; justify-content: center;
        }
        .tag { padding: 2px 4px; border-radius: 3px; color: white; white-space: nowrap; }
        .tag-self { background-color: var(--highlight); }
        .tag-target { background-color: var(--blue-text); }

        /* --- PH√ÇN T√çCH LAYOUT --- */
        .analysis-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .analysis-card {
            background: var(--white); border-radius: 12px; overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-top: 4px solid #ccc;
        }
        .card-self { border-color: var(--highlight); }
        .card-target { border-color: var(--blue-text); }

        .card-header {
            padding: 12px 15px; font-weight: bold; font-size: 1.1em;
            border-bottom: 1px solid #eee; background: #fafafa;
        }
        .card-self .card-header { color: var(--highlight); }
        .card-target .card-header { color: var(--blue-text); }

        .card-body { padding: 15px; }

        .detail-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px dashed #eee;
        }
        .detail-row:last-child { border-bottom: none; margin-bottom: 0; }
        
        .label { font-size: 0.9em; color: #666; font-weight: 600; width: 35%; }
        .content { width: 65%; text-align: right; font-weight: 500; }
        
        .highlight-val { font-weight: bold; color: #333; }
        .sub-text { display: block; font-size: 0.85em; color: #777; margin-top: 2px; font-style: italic; }

        .advice-box {
            grid-column: 1 / -1; background: var(--white); padding: 20px;
            border-radius: 12px; margin-top: 10px;
            border-left: 5px solid var(--green-text);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .advice-list { margin: 10px 0 0 0; padding-left: 20px; }
        .advice-list li { margin-bottom: 10px; line-height: 1.5; }
        .adv-label { font-weight: bold; display: inline-block; width: 140px; }

        #deviceInfo {
            text-align: center; font-size: 0.8em; color: #999; margin-top: -15px; margin-bottom: 20px;
        }

        /* --- MOBILE RESPONSIVE --- */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .controls { flex-direction: column; gap: 15px; }
            .input-group { width: 100%; }
            button { width: 100%; margin-top: 10px; }
            
            /* Chuy·ªÉn th√†nh 2 c·ªôt tr√™n mobile */
            .que-container { grid-template-columns: repeat(2, 1fr); }
            .pos-0, .pos-1, .pos-2, .pos-3, .pos-4, .pos-5 { grid-column: auto; grid-row: auto; }
            
            .analysis-wrapper { grid-template-columns: 1fr; }
            .adv-label { display: block; width: auto; margin-bottom: 3px; }
            
            .dia-chi { font-size: 1.2em; }
            .luc-than-body { font-size: 1em; }
        }
    </style>
</head>
<body>

    <h1>Ti·ªÉu L·ª•c Nh√¢m - Giang Th·ªã</h1>
    <div id="deviceInfo">ƒêang ph√°t hi·ªán thi·∫øt b·ªã...</div>
    
    <div class="controls">
        <div class="input-group">
            <label>1. Nh·∫≠p S·ªë (T√¢m ƒë·ªông):</label>
            <input type="number" id="inputNumber" min="1" placeholder="VD: 9">
        </div>
        <div class="input-group">
            <label>2. Ch·ªçn S·ª± Vi·ªác (D·ª•ng Th·∫ßn):</label>
            <select id="inputDungThan">
                <option value="B·∫£n Th√¢n">B·∫£n Th√¢n (C·∫ßu m∆∞u chung)</option>
                <option value="Th√™ T√†i">Th√™ T√†i (Ti·ªÅn, V·ª£)</option>
                <option value="Quan Qu·ª∑">Quan Qu·ª∑ (C√¥ng danh, Ch·ªìng, B·ªánh)</option>
                <option value="Ph·ª• M·∫´u">Ph·ª• M·∫´u (Cha m·∫π, Gi·∫•y t·ªù)</option>
                <option value="T·ª≠ T√¥n">T·ª≠ T√¥n (Con c√°i, Ph√∫c ƒë·ª©c)</option>
                <option value="Huynh ƒê·ªá">Huynh ƒê·ªá (Anh em, H·ª£p t√°c)</option>
            </select>
        </div>
        <div class="input-group">
            <label>3. Gi·ªù Xem:</label>
            <select id="inputHour">
                <option value="-1">-- T·ª± ƒë·ªông --</option>
                <option value="0">T√Ω (23-1h)</option>
                <option value="1">S·ª≠u (1-3h)</option>
                <option value="2">D·∫ßn (3-5h)</option>
                <option value="3">M√£o (5-7h)</option>
                <option value="4">Th√¨n (7-9h)</option>
                <option value="5">T·ªµ (9-11h)</option>
                <option value="6">Ng·ªç (11-13h)</option>
                <option value="7">M√πi (13-15h)</option>
                <option value="8">Th√¢n (15-17h)</option>
                <option value="9">D·∫≠u (17-19h)</option>
                <option value="10">Tu·∫•t (19-21h)</option>
                <option value="11">H·ª£i (21-23h)</option>
            </select>
        </div>
        <button onclick="lapQue()">AN QU·∫∫</button>
    </div>

    <div id="resultArea" style="display:none;">
        <div class="que-container">
            <div id="cung-1" class="cung-box pos-1"></div>
            <div id="cung-2" class="cung-box pos-2"></div>
            <div id="cung-3" class="cung-box pos-3"></div>
            <div id="cung-0" class="cung-box pos-0"></div>
            <div id="cung-5" class="cung-box pos-5"></div>
            <div id="cung-4" class="cung-box pos-4"></div>
        </div>

        <div class="analysis-wrapper">
            <div class="analysis-card card-self">
                <div class="card-header">üë§ 1. PH√ÇN T√çCH B·∫¢N TH√ÇN (G·ªëc)</div>
                <div class="card-body">
                    <div class="detail-row">
                        <div class="label">L·ª•c Cung</div>
                        <div class="content">
                            <div class="highlight-val" id="selfCungName"></div>
                            <span class="sub-text" id="selfCungMeaning"></span>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="label">ƒê·ªãa Chi</div>
                        <div class="content">
                            <div class="highlight-val" id="selfChiName"></div>
                            <span class="sub-text" id="selfChiHanh"></span>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="label">L·ª•c Th·∫ßn</div>
                        <div class="content">
                            <div class="highlight-val" id="selfThanName"></div>
                            <span class="sub-text" id="selfThanMeaning"></span>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="label">Ng≈© Tinh</div>
                        <div class="content">
                            <div class="highlight-val" id="selfTinhName"></div>
                            <span class="sub-text" id="selfTinhInteract"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="analysis-card card-target">
                <div class="card-header">üéØ 2. PH√ÇN T√çCH S·ª∞ VI·ªÜC (Ng·ªçn): <span id="targetSubjectHeader" style="text-transform: uppercase; color:var(--blue-text)"></span></div>
                <div class="card-body">
                    <div class="detail-row">
                        <div class="label">L·ª•c Cung</div>
                        <div class="content">
                            <div class="highlight-val" id="targetCungName"></div>
                            <span class="sub-text" id="targetCungMeaning"></span>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="label">ƒê·ªãa Chi</div>
                        <div class="content">
                            <div class="highlight-val" id="targetChiName"></div>
                            <span class="sub-text" id="targetChiHanh"></span>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="label">L·ª•c Th·∫ßn</div>
                        <div class="content">
                            <div class="highlight-val" id="targetThanName"></div>
                            <span class="sub-text" id="targetThanMeaning"></span>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="label">Ng≈© Tinh</div>
                        <div class="content">
                            <div class="highlight-val" id="targetTinhName"></div>
                            <span class="sub-text" id="targetTinhInteract"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="advice-box">
                <h3 style="margin-top:0; color:var(--green-text)">üìå L·ªùi Khuy√™n C·ª• Th·ªÉ (Theo S√°ch):</h3>
                <p><strong>üîó Quan h·ªá Ng≈© H√†nh (B·∫£n Th√¢n vs S·ª± Vi·ªác):</strong> <span id="relSinhKhac"></span></p>
                <p><strong>üîó Quan h·ªá ƒê·ªãa Chi (Xung/H·ª£p):</strong> <span id="relDiaChi"></span></p>
                <hr style="border:0; border-top:1px dashed #ccc; margin: 15px 0;">
                <div>
                    <ul id="bookAdvice" class="advice-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- NH·∫¨N DI·ªÜN THI·∫æT B·ªä ---
        function detectDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
            const deviceEl = document.getElementById('deviceInfo');
            if (isMobile) {
                deviceEl.innerText = "üì± ƒê√£ ph√°t hi·ªán giao di·ªán ƒëi·ªán tho·∫°i - ƒê√£ t·ªëi ∆∞u hi·ªÉn th·ªã.";
                deviceEl.style.color = "#2e7d32";
            } else {
                deviceEl.innerText = "üíª ƒêang s·ª≠ d·ª•ng giao di·ªán m√°y t√≠nh.";
            }
        }
        detectDevice();
        window.onresize = detectDevice;

        // --- D·ªÆ LI·ªÜU T·ª™ T√ÄI LI·ªÜU GIANG TH·ªä ---
        
        const CUNG = ["ƒê·∫°i An", "L∆∞u Li√™n", "T·ªëc H·ª∑", "X√≠ch Kh·∫©u", "Ti·ªÉu C√°t", "Kh√¥ng Vong"];
        const CUNG_MEANING = [
            "Tƒ©nh, ·ªïn ƒë·ªãnh, c√°t t∆∞·ªùng, b·∫•t ƒë·ªông.", 
            "Tr√¨ ho√£n, d√¢y d∆∞a, ch∆∞a r√µ r√†ng, l·∫∑p l·∫°i.", 
            "Nhanh ch√≥ng, vui v·∫ª, ch·ªß ƒë·ªông, h·ª∑ s·ª±.", 
            "Tranh ch·∫•p, th·ªã phi, v·∫•t v·∫£, nguy hi·ªÉm.", 
            "H√≤a h·ª£p, t·ªët ƒë·∫πp, ƒë√†o hoa, thu·∫≠n l·ª£i.", 
            "H∆∞ v√¥, lo l·∫Øng, th·∫•t b·∫°i, kh√¥ng th√†nh." 
        ];

        const DIA_CHI = ["T√Ω", "S·ª≠u", "D·∫ßn", "M√£o", "Th√¨n", "T·ªµ", "Ng·ªç", "M√πi", "Th√¢n", "D·∫≠u", "Tu·∫•t", "H·ª£i"];
        const HANH_DIA_CHI = [0, 3, 1, 1, 3, 2, 2, 3, 4, 4, 3, 0]; // 0:Th·ªßy, 1:M·ªôc, 2:H·ªèa, 3:Th·ªï, 4:Kim
        const TEN_HANH = ["Th·ªßy", "M·ªôc", "H·ªèa", "Th·ªï", "Kim"];

        const LUC_THAN = ["Thanh Long", "Chu T∆∞·ªõc", "C√¢u Tr·∫ßn", "B·∫°ch H·ªï", "Huy·ªÅn V≈©", "ƒê·∫±ng X√†"];
        const LUC_THAN_MEANING = [
            "C√°t th·∫ßn: Qu√Ω nh√¢n, vui v·∫ª, ch√≠nh tr·ª±c, m·ªõi m·∫ª.", 
            "C√°t th·∫ßn: VƒÉn th∆∞, tin t·ª©c, kh·∫©u thi·ªát, n√≥ng n·∫£y.", 
            "Trung t√≠nh: ƒêi·ªÅn th·ªï, ch·∫≠m ch·∫°p, tranh ch·∫•p, c·ª©ng nh·∫Øc.", 
            "Hung th·∫ßn: Tai h·ªça, m√°u me, uy quy·ªÅn, n√≥ng n·∫£y.", 
            "Hung th·∫ßn: M·ªù √°m, ti·ªÉu nh√¢n, tr·ªôm c·∫Øp, d·ªëi tr√°.", 
            "Hung th·∫ßn: Qu√°i d·ªã, lo √¢u, gi·∫£ d·ªëi, thay ƒë·ªïi." 
        ];

        const NGU_TINH = ["M·ªôc", "H·ªèa", "Th·ªï", "Kim", "Th·ªßy", "Kh√¥ng"];
        const TINH_TO_HANH = [1, 2, 3, 4, 0, -1]; 

        // D·ªØ li·ªáu L·ªùi Khuy√™n (ƒê√£ t√°ch r√µ)
        const ADVICE_DB = [
            // ƒê·∫°i An
            {
                qn: "S·ª≠u, T√Ω, M√πi, Ng·ªç", 
                tn: "Th√¨n, D·∫≠u", 
                ht: "T√¢y Nam, ƒê√¥ng B·∫Øc", 
                hx: "T√¢y, T√¢y B·∫Øc, Nam (Hao t√†i)"
            }, 
            // L∆∞u Li√™n
            {
                qn: "M√£o, Tu·∫•t", 
                tn: "Ng·ªç, M√πi, T√Ω, S·ª≠u", 
                ht: "Nam", 
                hx: "ƒê√¥ng B·∫Øc, T√¢y Nam, ƒê√¥ng, ƒê√¥ng Nam"
            }, 
            // T·ªëc H·ª∑
            {
                qn: "Th√¨n, D·∫≠u", 
                tn: "T·ªµ, Th√¢n", 
                ht: "T√¢y, T√¢y B·∫Øc", 
                hx: "B·∫Øc, ƒê√¥ng B·∫Øc, T√¢y Nam"
            }, 
            // X√≠ch Kh·∫©u
            {
                qn: "D·∫ßn, H·ª£i", 
                tn: "M√£o, Tu·∫•t", 
                ht: "ƒê√¥ng, ƒê√¥ng Nam", 
                hx: "Nam, B·∫Øc (Hao t·ªïn)"
            }, 
            // Ti·ªÉu C√°t
            {
                qn: "S·ª≠u, T√Ω, M√πi, Ng·ªç", 
                tn: "Th√¨n, D·∫≠u", 
                ht: "T√¢y Nam, ƒê√¥ng B·∫Øc", 
                hx: "T√¢y, T√¢y B·∫Øc, Nam"
            }, 
            // Kh√¥ng Vong
            {
                qn: "T·ªµ, Th√¢n", 
                tn: "D·∫ßn, H·ª£i", 
                ht: "B·∫Øc", 
                hx: "ƒê√¥ng, ƒê√¥ng Nam, T√¢y, T√¢y B·∫Øc"
            } 
        ];

        // --- LOGIC T√çNH TO√ÅN ---

        function layGioHienTai() {
            const h = new Date().getHours();
            if (h >= 23 || h < 1) return 0; if (h < 3) return 1; if (h < 5) return 2;
            if (h < 7) return 3; if (h < 9) return 4; if (h < 11) return 5;
            if (h < 13) return 6; if (h < 15) return 7; if (h < 17) return 8;
            if (h < 19) return 9; if (h < 21) return 10; return 11;
        }

        function checkSinhKhac(hanhA, hanhB) {
            if (hanhA === hanhB) return "T∆∞∆°ng H√≤a (B√¨nh)";
            if ((hanhA===0 && hanhB===1) || (hanhA===1 && hanhB===2) || (hanhA===2 && hanhB===3) || (hanhA===3 && hanhB===4) || (hanhA===4 && hanhB===0)) return "Sinh Xu·∫•t (Ta sinh Vi·ªác -> V·∫•t v·∫£)";
            if ((hanhB===0 && hanhA===1) || (hanhB===1 && hanhA===2) || (hanhB===2 && hanhA===3) || (hanhB===3 && hanhA===4) || (hanhB===4 && hanhA===0)) return "Sinh Nh·∫≠p (Vi·ªác sinh Ta -> Thu·∫≠n l·ª£i)";
            if ((hanhA===0 && hanhB===2) || (hanhA===1 && hanhB===3) || (hanhA===2 && hanhB===4) || (hanhA===3 && hanhB===0) || (hanhA===4 && hanhB===1)) return "Kh·∫Øc Xu·∫•t (Ta kh·∫Øc Vi·ªác -> Chi·∫øm ∆∞u th·∫ø)";
            return "Kh·∫Øc Nh·∫≠p (Vi·ªác kh·∫Øc Ta -> √Åp l·ª±c/Th·∫•t b·∫°i)";
        }

        function getStarInteraction(tinhIdx, hanhDiaChi) {
            if (tinhIdx === 5) return "Sao Thi√™n Kh√¥ng: Ch·ªß h∆∞ v√¥, kh√≥ th√†nh.";
            let hanhTinh = TINH_TO_HANH[tinhIdx];
            if ((hanhTinh===0 && hanhDiaChi===1) || (hanhTinh===1 && hanhDiaChi===2) || (hanhTinh===2 && hanhDiaChi===3) || (hanhTinh===3 && hanhDiaChi===4) || (hanhTinh===4 && hanhDiaChi===0)) 
                return "Sao SINH ƒê·ªãa chi: R·∫•t t·ªët, c√≥ tr·ª£ l·ª±c.";
            if ((hanhTinh===0 && hanhDiaChi===2) || (hanhTinh===1 && hanhDiaChi===3) || (hanhTinh===2 && hanhDiaChi===4) || (hanhTinh===3 && hanhDiaChi===0) || (hanhTinh===4 && hanhDiaChi===1)) 
                return "Sao KH·∫ÆC ƒê·ªãa chi: X·∫•u, b·ªã c·∫£n tr·ªü.";
            if (hanhTinh === hanhDiaChi) return "Sao T∆Ø∆†NG H√íA: B√¨nh ·ªïn.";
            return "Sao TI·∫æT KH√ç: Hao t·ªïn s·ª©c l·ª±c.";
        }

        function checkDiaChiRel(chiA, chiB) {
            if (chiA === chiB) return "Th√°i Tu·∫ø (Tr√πng nhau)";
            if (Math.abs(chiA - chiB) === 6) return "L·ª•c Xung (X·∫•u - Xung ƒë·ªôt)";
            let sum = chiA + chiB;
            if ((chiA===0 && chiB===1) || (chiA===1 && chiB===0) || sum === 13 || (chiA===6 && chiB===7) || (chiA===7 && chiB===6)) return "L·ª•c H·ª£p (T·ªët - H√≤a h·ª£p)";
            return "B√¨nh th∆∞·ªùng";
        }

        function getElementRelation(selfElem, targetElem) {
            if (selfElem === targetElem) return "Huynh ƒê·ªá";
            if ((targetElem === 0 && selfElem === 1) || (targetElem === 1 && selfElem === 2) || (targetElem === 2 && selfElem === 3) || (targetElem === 3 && selfElem === 4) || (targetElem === 4 && selfElem === 0)) return "Ph·ª• M·∫´u"; 
            if ((selfElem === 0 && targetElem === 1) || (selfElem === 1 && targetElem === 2) || (selfElem === 2 && targetElem === 3) || (selfElem === 3 && targetElem === 4) || (selfElem === 4 && targetElem === 0)) return "T·ª≠ T√¥n"; 
            if ((targetElem === 0 && selfElem === 2) || (targetElem === 1 && selfElem === 3) || (targetElem === 2 && selfElem === 4) || (targetElem === 3 && selfElem === 0) || (targetElem === 4 && selfElem === 1)) return "Quan Qu·ª∑"; 
            return "Th√™ T√†i";
        }

        function lapQue() {
            let inputVal = document.getElementById("inputNumber").value;
            let selectedDungThan = document.getElementById("inputDungThan").value;
            if (!inputVal || inputVal <= 0) { alert("Vui l√≤ng nh·∫≠p s·ªë d∆∞∆°ng!"); return; }
            let num = parseInt(inputVal);
            let hourVal = parseInt(document.getElementById("inputHour").value);
            if (hourVal === -1) hourVal = layGioHienTai();

            // T√≠nh to√°n
            let dayPalaceIndex = (num - 1) % 6;
            let hourPalaceIndex = (dayPalaceIndex + hourVal) % 6;
            
            let palaceToChi = new Array(6).fill(null);
            let currentPalace = hourPalaceIndex; let currentChi = hourVal;
            for (let i = 0; i < 6; i++) {
                palaceToChi[currentPalace] = currentChi;
                currentPalace = (currentPalace + 1) % 6;
                currentChi = (currentChi + 2) % 12;
            }

            let startThanhLong = hourVal % 6;
            let palaceToLucThan = new Array(6).fill(null);
            let palaceToLucThanIdx = new Array(6).fill(null);
            for (let i = 0; i < 6; i++) { 
                let idx = (startThanhLong + i) % 6;
                palaceToLucThan[idx] = LUC_THAN[i];
                palaceToLucThanIdx[idx] = i;
            }

            let palaceToNguTinh = new Array(6).fill(null);
            let palaceToNguTinhIdx = new Array(6).fill(null);
            for (let i = 0; i < 6; i++) { 
                let idx = (dayPalaceIndex + i) % 6;
                palaceToNguTinh[idx] = NGU_TINH[i];
                palaceToNguTinhIdx[idx] = i;
            }

            let selfChi = hourVal;
            let selfHanh = HANH_DIA_CHI[selfChi];
            let palaceToLucThanBody = new Array(6).fill(null);
            let relations = [];
            for(let i=0; i<6; i++) {
                let chi = palaceToChi[i];
                let rel = getElementRelation(selfHanh, HANH_DIA_CHI[chi]);
                relations.push({palaceIdx: i, rel: rel});
            }
            if (selfHanh !== 3) {
                for(let k=0; k<6; k++) {
                    let idx = (hourPalaceIndex + k) % 6;
                    if (HANH_DIA_CHI[palaceToChi[idx]] === 3) { relations.find(r => r.palaceIdx === idx).rel = "Huynh ƒê·ªá"; break; }
                }
            }
            relations.find(r => r.palaceIdx === hourPalaceIndex).rel = "B·∫£n Th√¢n";
            for(let item of relations) palaceToLucThanBody[item.palaceIdx] = item.rel;

            // Hi·ªÉn th·ªã
            document.getElementById("resultArea").style.display = "block";

            let selfData = {};
            let targetData = {};
            let targetIdx = -1;

            for (let i = 0; i < 6; i++) {
                let cellId = "cung-" + i;
                let el = document.getElementById(cellId);
                
                let chiName = DIA_CHI[palaceToChi[i]];
                let thanName = palaceToLucThan[i];
                let tinhName = palaceToNguTinh[i];
                let bodyName = palaceToLucThanBody[i];
                let hanhHienTai = HANH_DIA_CHI[palaceToChi[i]];

                el.className = "cung-box " + "pos-" + i;

                let currentData = {
                    cungName: CUNG[i],
                    cungMeaning: CUNG_MEANING[i],
                    chiName: chiName,
                    hanhName: TEN_HANH[hanhHienTai],
                    hanhVal: hanhHienTai,
                    chiVal: palaceToChi[i],
                    thanName: thanName,
                    thanMeaning: LUC_THAN_MEANING[palaceToLucThanIdx[i]],
                    tinhName: tinhName,
                    tinhInteract: getStarInteraction(palaceToNguTinhIdx[i], hanhHienTai)
                };

                if (i === hourPalaceIndex) {
                    el.classList.add("self-cung");
                    selfData = currentData;
                }
                if (bodyName === selectedDungThan) {
                    el.classList.add("target-cung");
                    targetData = currentData;
                    targetIdx = i;
                }

                let markers = "";
                if (i === dayPalaceIndex) markers += "<span class='tag tag-self'>Ng√†y</span>";
                if (i === hourPalaceIndex) markers += "<span class='tag tag-target'>Th√¢n</span>";

                el.innerHTML = `
                    <div class="top-info"><span class="ngu-tinh">${tinhName}</span><span class="luc-than">${thanName}</span></div>
                    <div class="dia-chi">${chiName}</div>
                    <div class="luc-than-body">${bodyName}</div>
                    <div class="cung-name">${CUNG[i]}</div>
                    <div class="markers">${markers}</div>
                `;
            }

            // Fill Analysis
            document.getElementById("selfCungName").innerText = selfData.cungName;
            document.getElementById("selfCungMeaning").innerText = selfData.cungMeaning;
            document.getElementById("selfChiName").innerText = selfData.chiName;
            document.getElementById("selfChiHanh").innerText = `H√†nh: ${selfData.hanhName}`;
            document.getElementById("selfThanName").innerText = selfData.thanName;
            document.getElementById("selfThanMeaning").innerText = selfData.thanMeaning;
            document.getElementById("selfTinhName").innerText = selfData.tinhName;
            document.getElementById("selfTinhInteract").innerText = selfData.tinhInteract;

            document.getElementById("targetSubjectHeader").innerText = selectedDungThan;
            document.getElementById("targetCungName").innerText = targetData.cungName;
            document.getElementById("targetCungMeaning").innerText = targetData.cungMeaning;
            document.getElementById("targetChiName").innerText = targetData.chiName;
            document.getElementById("targetChiHanh").innerText = `H√†nh: ${targetData.hanhName}`;
            document.getElementById("targetThanName").innerText = targetData.thanName;
            document.getElementById("targetThanMeaning").innerText = targetData.thanMeaning;
            document.getElementById("targetTinhName").innerText = targetData.tinhName;
            document.getElementById("targetTinhInteract").innerText = targetData.tinhInteract;

            // Relations
            let relSinhKhac = checkSinhKhac(selfData.hanhVal, targetData.hanhVal);
            document.getElementById("relSinhKhac").innerText = relSinhKhac;

            let relDiaChi = checkDiaChiRel(selfData.chiVal, targetData.chiVal);
            document.getElementById("relDiaChi").innerText = relDiaChi;

            // Advice List
            let advice = ADVICE_DB[targetIdx];
            let adviceHTML = `
                <li><span class="adv-label" style="color:#388e3c">üåü Qu√Ω Nh√¢n:</span> ${advice.qn}</li>
                <li><span class="adv-label" style="color:#d32f2f">üö´ Ti·ªÉu Nh√¢n:</span> ${advice.tn}</li>
                <li><span class="adv-label" style="color:#1976d2">‚¨Ü H∆∞·ªõng T·ªët:</span> ${advice.ht}</li>
                <li><span class="adv-label" style="color:#555">‚¨á H∆∞·ªõng X·∫•u:</span> ${advice.hx}</li>
            `;
            document.getElementById("bookAdvice").innerHTML = adviceHTML;
        }
    </script>
</body>
</html>